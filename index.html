<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Moviecats</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous" />
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="https://unpkg.com/@hpcc-js/wasm@0.3.11/dist/index.min.js"></script>
    <script src="https://unpkg.com/d3-graphviz@3.0.5/build/d3-graphviz.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9/core.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9/sha256.js"></script>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
</head>

<body>
    <nav class="navbar navbar-dark bg-dark mb-5" id="nav1">
        <input type="image"
            src="https://png.pngtree.com/element_our/png_detail/20190103/cat-book-vector-logo-design-png_309891.jpg"
            width="40" height="50" class="navbar-brand mb-1 d-inline-block align-top" onclick="returnHome()" />
        <a class="navbar-brand mb-1">Main</a>
        <a class="navbar-brand mb-1">Acerca de</a>
        <a class="navbar-brand mb-1">Contactenos</a>
        <a class="navbar-brand mb-1">Informacion</a>
    </nav>
    <nav class="navbar navbar-dark bg-dark mb-5" id="nav2" style="display:none">
        <a class="navbar-brand" href="index.html">
            <img src="https://png.pngtree.com/element_our/png_detail/20190103/cat-book-vector-logo-design-png_309891.jpg"
                width="30" height="30" class="d-inline-block align-top" alt="" />
            Catsbooks
        </a>
        <a class="navbar-brand mb-1" href="main.html">Main</a>
        <a class="navbar-brand mb-1" href="acercade.html">Acerca de</a>
        <a class="navbar-brand mb-1" href="contacto.html">Contactenos</a>
        <a class="navbar-brand mb-1" href="informacion.html">Informacion</a>
    </nav>
    <nav class="navbar navbar-dark bg-dark mb-5" id="nav3" style="display:none">
        <a class="navbar-brand" href="index.html">
            <img src="https://png.pngtree.com/element_our/png_detail/20190103/cat-book-vector-logo-design-png_309891.jpg"
                width="30" height="30" class="d-inline-block align-top" alt="" />
            Catsbooks
        </a>
        <a class="navbar-brand mb-1" href="main.html">Main</a>
        <a class="navbar-brand mb-1" href="acercade.html">Acerca de</a>
        <a class="navbar-brand mb-1" href="contacto.html">Contactenos</a>
        <a class="navbar-brand mb-1" href="informacion.html">Informacion</a>
    </nav>
    <div id="page1">
        <!--Login-->
        <div class="container">
            <div class="row">
                <div class="col">
                    <h1 class="text-center mb-5">Login</h1>
                    <form id="loginForm">
                        <div class="form-group">
                            <label for="loginNickname">User</label>
                            <input type="text" class="form-control" id="loginNickname" aria-describedby="nicknameHelp"
                                placeholder="Enter your User" />
                        </div>
                        <div class="form-group">
                            <label for="loginPassword">Password</label>
                            <input type="password" class="form-control" id="loginPassword"
                                placeholder="Enter your password" />
                        </div>
                        <input id="adminOrNot" type="checkbox" class="form-check-input"
                            style="margin-left:10px ;"></input>
                        <label class="form-check-label" for="flexCheckDefault" style="margin-left: 25px">Admin</label>
                        <button id="loginButton" type="submit" class="btn btn-primary w-100">
                            Login
                        </button>
                    </form>
                </div>
                <div class="col">
                    <h1 class="text-center mb-5">Signup</h1>
                    <form id="signupForm">
                        <div class="form-group">
                            <label for="signupDPI">DPI</label>
                            <input type="text" class="form-control" id="signupDPI" placeholder="Enter your DPI" />
                        </div>
                        <div class="form-group">
                            <label for="signupName">Full Name</label>
                            <input type="text" class="form-control" id="signupName"
                                placeholder="Enter your Full Name" />
                        </div>
                        <div class="form-group">
                            <label for="signupUser">Username</label>
                            <input type="text" class="form-control" id="signupUser" placeholder="Enter your Username" />
                        </div>

                        <div class="form-group">
                            <label for="signupCorreo">Correo Electronico</label>
                            <input type="text" class="form-control" id="signupCorreo"
                                placeholder="Enter your Email Address">
                            </input>
                        </div>
                        <div class="form-group">
                            <label for="signupPassword">Password</label>
                            <input type="password" class="form-control" id="signupPassword"
                                placeholder="Enter a password" />
                        </div>
                        <div class="form-group">
                            <label for="signupPhone">Phone Number</label>
                            <input type="number" class="form-control" id="signupPhone"
                                placeholder="Enter your phone Number" />
                        </div>
                        <button id="signupButton" type="submit" class="btn btn-primary w-100">
                            Signup
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <div id="page2" style="display:none">
        <!--Admin display buttons to load files and to show the structures-->
        <form id="formPeliculas">
            <label class="btn btn-primary custom" for="myfile2">Peliculas: </label>
            <input class="btn btn-info" type="file" id="myfile2" accept=".json">
            <button class="btn btn-outline-primary">Upload</button>
        </form>
        <form id="formActores">
            <label class="btn btn-primary custom" for="myfile1">Actors: </label>
            <input type="file" class="btn btn-info" id="myfile1" accept=".json">
            <button class="btn btn-outline-primary">Upload</button>
        </form>
        <form id="formUsuarios">
            <label class="btn btn-primary custom" for="myfile3">Users: </label>
            <input type="file" class="btn btn-info" id="myfile3" accept=".json">
            <button class="btn btn-outline-primary">Upload</button>
        </form>
        <form id="formCategorias">
            <label class="btn btn-primary custom" for="myfile4">Categorias: </label>
            <input type="file" class="btn btn-info" id="myfile4" accept=".json">
            <button class="btn btn-outline-primary">Upload</button>
        </form>
        <button id="dwl" class="btn btn-outline-primary">Download</button>
        <canvas id="myCanvas" width="1000" height="1000" style="display: none"></canvas>
        <div id="graph"></div>
    </div>
    <div id="page3" style="display: none">
        <!--Customer display the front page and the option to view the books and order books-->
        <button class="btn btn-outline-primary" onclick="showInOrder()">Actores En Orden</button>
        <button class="btn btn-outline-primary" onclick="showPreOrder()">Actores Pre Orden</button>
        <button class="btn btn-outline-primary" onclick="showPostOrder()">Actores Post Orden</button>
        <button class="btn btn-outline-primary" onclick="showMovies()">Mostrar Peliculas</button>
        <button class="btn btn-outline-primary" onclick="showMoviesPre()">Mostrar Peliculas Asc</button>
        <button class="btn btn-outline-primary" onclick="showMoviesPost()">Mostrar Peliculas Desc</button>
        <button class="btn btn-outline-primary" onclick="showCategories()">Mostrar Categorias</button>
        <div id="actores_Info"></div>
        <div id="peliculas_Info"></div>
        <div id="categoria_Info"></div>


    </div>
    <script type="text/javascript" src="../Estructuras/ABB_Actors.js"></script>
    <script type="text/javascript" src="../Estructuras/Arbol_Merkle.js"></script>
    <script type="text/javascript" src="../Estructuras/AVL_Pelicula.js"></script>
    <script type="text/javascript" src="../Estructuras/List_Users.js"></script>
    <script type="text/javascript" src="../Estructuras/TH_Categorias.js"></script>
    <script type="text/javascript" src="../Estructuras/List.js"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>
    <script>
        function load_Movies() {
            load_Movies_Helper(peliculas.root);
        };

        function load_Movies_Helper(rend) {
            if (rend) {
                load_Movies_Info(rend);
                load_Movies_Helper(rend.left);
                load_Movies_Helper(rend.right);
            }
        }

        function displayMovieAsc() {
            let current = sort.head;
            let stop = false;
            while (current) {
                load_Movies_Info(current);
                current = current.next;
                stop = true;
                if (current === sort.head && stop === true) {
                    break;
                }
            }
        }

        function displayMovieDesc() {
            let current = sort.fin;
            let stop = false;
            while (current) {
                load_Movies_Info(current);
                current = current.prev;
                stop = true;
                if (current === sort.fin && stop === true) {
                    break;
                }
            }
        }

        function load_Movies_Info(rend) {
            console.log("z", rend.id_Pelicula);
            var movie_Name = document.createElement("h2");
            var movie_Info = document.createElement("p");
            var movie_Rent = document.createElement("button");
            var movie_Rate = document.createElement("h4");
            var newName = document.createTextNode(rend.nombre_Pelicula + " ID: " + rend.id_Pelicula + "\nPrecio: Q" + rend.precio_Q);
            var newDesc = document.createTextNode(rend.descripcion);
            var newRent = document.createTextNode("Rent");
            var newRate = document.createTextNode("Rating: " + rend.puntuacion_Star);
            movie_Name.appendChild(newName);
            movie_Info.appendChild(newDesc);
            movie_Rent.appendChild(newRent);
            movie_Rate.appendChild(newRate);
            var temp_1 = document.getElementById("peliculas_Info");
            temp_1.innerHTML += movie_Name.outerHTML;
            temp_1.innerHTML += movie_Info.outerHTML;
            temp_1.innerHTML += movie_Rate.outerHTML;
            temp_1.innerHTML += movie_Rent.outerHTML;
        }

        function display_TH() {
            let temp = tH_Cat.head;
            while (temp) {
                if (temp.id_Categoria != null) {
                    load_TH_Info(temp.id_Categoria, temp.company);
                }
                let temp_ = temp.list;
                while (temp_) {
                    load_TH_Info(temp_.id_Categoria, temp.company);
                    temp_ = temp_.list;
                }
                temp = temp.next;
            }
        }

        function load_TH_Info(rend, rend1) {
            console.log(rend);
            var TH_Company = document.createElement("h2");
            var TH_id = document.createElement("p");
            var newContent = document.createTextNode(rend1);
            var newContenido = document.createTextNode(rend);
            TH_Company.appendChild(newContent);
            TH_id.appendChild(newContenido);
            var temp_1 = document.getElementById("categoria_Info");
            temp_1.innerHTML += TH_Company.outerHTML;
            temp_1.innerHTML += TH_id.outerHTML;
        }
        //Login
        let page1 = document.getElementById("page1");
        let page2 = document.getElementById("page2");
        let page3 = document.getElementById("page3");

        let loginForm = document.getElementById("loginForm");
        let loginNickname = document.getElementById("loginNickname");
        let loginPassword = document.getElementById("loginPassword");
        let loginButton = document.getElementById("loginButton");
        let logTest = document.getElementById("adminOrNot");

        loginForm.addEventListener("submit", (e) => {
            e.preventDefault();
        });
        loginButton.addEventListener("click", (e) => { //Change API to regular JS
            temp = users.login(loginNickname.value, loginPassword.value);
            userInfo = temp;
            //console.log("ghy", temp);
            if (temp === false) {
                console.log("Wrong Information Entered");
            } else if (logTest.checked === false) { // Test function for swapping between pages
                console.log("Yes, You're In Pleb");
                load_Movies();
                page1.style.display = "none";
                page3.style.display = "";
                page2.style.display = "none";
            } else {
                console.log("Yes, You're In Boss");
                page1.style.display = "none";
                page2.style.display = "";
                page3.style.display = "none";
            }
            document.getElementById("loginForm").reset();
        });

        function returnHome() {
            console.log("Home Time");
            page1.style.display = "";
            page2.style.display = "none";
            page3.style.display = "none";
        }

        //Signup
        let signupForm = document.getElementById("signupForm");
        let signupDPI = document.getElementById("signupDPI");
        let signupName = document.getElementById("signupName");
        let signupUser = document.getElementById("signupUser");
        let signupCorreo = document.getElementById("signupCorreo");
        let signupPassword = document.getElementById("signupPassword");
        let signupPhone = document.getElementById("signupPhone");
        let signupButton = document.getElementById("signupButton");

        signupForm.addEventListener("submit", (e) => {
            e.preventDefault();
        });

        signupButton.addEventListener("click", (e) => {
            users.insert(parseInt(signupDPI.value), signupName.value, signupUser.value, signupCorreo.value, signupPassword.value, signupPhone.value);
            document.getElementById("signupForm").reset();
        });

        let divGraph = document.getElementById('graph');

        //Upload Files Peliculas
        let form1 = document.querySelector('#formPeliculas');
        let file1 = document.querySelector('#myfile2');

        function logFile1(event) {
            let str = event.target.result;
            let json = JSON.parse(str);
            for (let i = 0; i < json.length; i++) {
                peliculas.insertNode(json[i].id_pelicula, json[i].nombre_pelicula, json[i].descripcion, json[i].puntuacion_star, json[i].precio_Q);
                sort.insert(json[i].id_pelicula, json[i].nombre_pelicula, json[i].descripcion, json[i].puntuacion_star, json[i].precio_Q);
            }
        }

        function handleSubmit1(event) {
            event.preventDefault();
            if (!file1.value.length) return;
            let reader = new FileReader();
            reader.onload = logFile1;
            reader.readAsText(file1.files[0]);
            setTimeout(function () {
                peliculas.graph("#graph");
                sort.BBS();
            }, (1 * 1000));
        }

        form1.addEventListener('submit', handleSubmit1);

        //Upload Files Actores
        let form = document.querySelector('#formActores');
        let file = document.querySelector('#myfile1');

        function logFile(event) {
            let str = event.target.result;
            let json = JSON.parse(str);
            for (let i = 0; i < json.length; i++) {
                abb.insert(json[i].dni, json[i].nombre_actor, json[i].correo, json[i].descripcion);
            }
        }

        function handleSubmit(event) {
            event.preventDefault();
            if (!file.value.length) return;
            let reader = new FileReader();
            reader.onload = logFile;
            reader.readAsText(file.files[0]);
            setTimeout(function () {
                abb.graph("#graph");
            }, (1 * 1000));

        }

        form.addEventListener('submit', handleSubmit);

        //Upload Files Usuarios
        let form2 = document.querySelector('#formUsuarios');
        let file2 = document.querySelector('#myfile3');

        function logFile2(event) {
            let str = event.target.result;
            let json = JSON.parse(str);
            for (let i = 0; i < json.length; i++) {
                users.insert(json[i].dpi, json[i].nombre_completo, json[i].nombre_usuario, json[i].correo, json[i].contrasenia, json[i].telefono);
            }
        }

        function handleSubmit2(event) {
            event.preventDefault();
            if (!file2.value.length) return;
            let reader = new FileReader();
            reader.onload = logFile2;
            reader.readAsText(file2.files[0]);
            setTimeout(function () {
                users.graph("#graph");
            }, (1 * 1000));
        }

        form2.addEventListener('submit', handleSubmit2);

        //Upload Files Categorias
        let form3 = document.querySelector('#formCategorias');
        let file3 = document.querySelector('#myfile4');

        function logFile3(event) {
            let str = event.target.result;
            let json = JSON.parse(str);
            for (let i = 0; i < json.length; i++) {
                tH_Cat.insert2(json[i].id_categoria, json[i].company);
            }
        }

        function handleSubmit3(event) {
            event.preventDefault();
            if (!file3.value.length) return;
            let reader = new FileReader();
            reader.onload = logFile3;
            reader.readAsText(file3.files[0]);
            setTimeout(function () {
                tH_Cat.graph("#graph");
            }, (1 * 1000));
        }

        form3.addEventListener('submit', handleSubmit3);

        //Additional functions
        function displayAIO(temp = abb.raiz, go) {
            if (temp === null) {
                return;
            }
            displayAIO(temp.left, go);
            load_Actor_Info(temp);
            displayAIO(temp.right, go);
        }

        function displayAPreO(temp = abb.raiz) {
            if (temp === null) {
                return;
            }
            load_Actor_Info(temp);
            displayAPreO(temp.left);
            displayAPreO(temp.right);
        }

        function displayAPostO(temp = abb.raiz) {
            if (temp === null) {
                return;
            }
            displayAPostO(temp.left);
            displayAPostO(temp.right);
            load_Actor_Info(temp);
        }

        function load_Actor_Info(rend) {
            console.log(rend.nombre_Actor);
            var actor_Name = document.createElement("h2");
            var actor_Info = document.createElement("p");
            var newContent = document.createTextNode(rend.nombre_Actor);
            var newContenido = document.createTextNode(rend.descripcion);
            actor_Name.appendChild(newContent);
            actor_Info.appendChild(newContenido);
            var temp_1 = document.getElementById("actores_Info");
            temp_1.innerHTML += actor_Name.outerHTML;
            temp_1.innerHTML += actor_Info.outerHTML;
        }

        let divActores1 = document.getElementById('actores_Info');
        let divPeliculas1 = document.getElementById('peliculas_Info');
        let divCategorias1 = document.getElementById('categoria_Info');

        function showMovies() {
            divPeliculas1.innerHTML = "";
            load_Movies();
            divCategorias1.style.display = "none";
            divActores1.style.display = "none";
            divPeliculas1.style.display = "";
        }

        function showMoviesPre() {
            divPeliculas1.innerHTML = "";
            displayMovieAsc();
            divCategorias1.style.display = "none";
            divActores1.style.display = "none";
            divPeliculas1.style.display = "";
        }

        function showMoviesPost() {
            divPeliculas1.innerHTML = "";
            displayMovieDesc();
            divCategorias1.style.display = "none";
            divActores1.style.display = "none";
            divPeliculas1.style.display = "";
        }

        function showInOrder() {
            divActores1.innerHTML = "";
            displayAIO();
            divCategorias1.style.display = "none";
            divActores1.style.display = "";
            divPeliculas1.style.display = "none";
        }

        function showPreOrder() {
            divActores1.innerHTML = "";
            displayAPreO();
            divActores1.style.display = "";
            divPeliculas1.style.display = "none";
            divCategorias1.style.display = "none";
        }

        function showPostOrder() {
            divActores1.innerHTML = "";
            displayAPostO();
            divActores1.style.display = "";
            divPeliculas1.style.display = "none";
            divCategorias1.style.display = "none";
        }

        function showCategories() {
            display_TH();
            divActores1.style.display = "none";
            divPeliculas1.style.display = "none";
            divCategorias1.style.display = "";
        }

        d3.select("#dwl").on("click", function () {
            var bodyc = d3.select('svg')
                .attr("xmlns", "http://www.w3.org/2000/svg")
                .node().parentNode.innerHTML;
            var etiqtyvsg = new Blob([bodyc], { type: "image/svg+xml;charset=utf-8" })
            var canvas = document.getElementById('myCanvas')
            var sxrt = canvas.getContext("2d")
            sxrt.clearRect(0, 0, canvas.width, canvas.height);
            var donurl = self.URL || self.webkitURL || self
            var url = donurl.createObjectURL(etiqtyvsg)
            var img = new Image;
            canvas.style.display = 'block';
            img.onload = function () {
                sxrt.drawImage(img, 0, 0)
                donurl.revokeObjectURL(url)
                var data = canvas.toDataURL("image/svg");
                var a = document.createElement('a')
                a.download = 'Data_Structures.png'
                a.href = data
                a.click()
            }
            img.src = url
            canvas.style.display = 'none';
        });
    </script>
</body>
</html>